<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Typist — Macros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link href="style.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
</head>
<body>
  <header class="topbar">
    <div class="left">
      <button id="cheatBtn" class="icon-btn" title="Cheat sheet" aria-label="Cheat sheet">
        <i class="fa-solid fa-circle-info"></i>
      </button>
      <h1 class="appTitle">Typist</h1>
    </div>
    <div class="center"><span id="fsStats">—/— KB</span></div>
    <div class="right"><button id="connect" class="btn">Connect</button></div>
  </header>

  <main>
    <section id="startupPanel" class="panel collapsible">
      <input id="startupToggle" class="collapse-check" type="checkbox" />
      <label class="collapse-bar" for="startupToggle">
        <h2>Startup Macro</h2>
        <i class="fa-solid fa-chevron-down chev" aria-hidden="true"></i>
      </label>

      <div class="collapse-body">
        <div class="row">
          <label for="startupSelect" class="inline">Use macro:</label>
          <select id="startupSelect"></select>
          <button id="saveStartupId">Save</button>
        </div>
        <br/>
        <div class="row">
          <label for="startupScript" class="inline">Or custom script:</label>
          <textarea id="startupScript" rows="3" placeholder="{{DELAY:1000}}{{CTRL+SHIFT+ESC}}"></textarea>
          <button id="saveStartupScript">Save</button>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="toolbar">
        <h2>Macros</h2>
        <div class="toolbar-actions">
          <button id="newMacro"><i class="fa fa-plus"></i> New</button>
          <button id="refresh"><i class="fa fa-rotate"></i> Refresh</button>
        </div>
      </div>
      <div id="grid" class="grid"></div>
    </section>
  </main>

  <!-- Docked Type & Send -->
  <section id="dock" class="panel dock">
    <h2>Type & Send</h2>
    <textarea id="text" rows="3" placeholder="Type here… (supports {{MACRO}} tokens)"></textarea>
    <div class="row sendbar">
      <!-- keep checkbox + text on the LEFT, checked by default -->
      <span class="inline">
        <input type="checkbox" id="sendEnter" checked />
        <span>
          ↵ after send
        </span>
      </span>
      <div class="spacer"></div>
      <button id="send"><i class="fa fa-paper-plane"></i> Send</button>
      <button id="sendReplace"><i class="fa fa-arrows-rotate"></i> Replace</button>
    </div>
  </section>

  <dialog id="editor">
    <form method="dialog" id="editorForm">
      <input type="hidden" id="mId" />
      <label>Title <input id="mTitle" required maxlength="24" /></label>

      <!-- icon select instead of free text -->
      <label>Icon
        <div class="iconRow">
          <select id="mIconSelect"></select>
          <i id="iconPreview" class="fa-solid fa-bolt"></i>
        </div>
      </label>

      <label>Script <textarea id="mScript" rows="6" placeholder="hello{{ENTER}}{{ALT+TAB}}"></textarea></label>
      <menu>
        <button id="save" type="submit" value="ok">Save</button>
        <button id="cancel" type="button">Cancel</button>
      </menu>
    </form>
  </dialog>

  <dialog id="cheatDialog" aria-labelledby="cheatTitle">
    <h3 id="cheatTitle" style="margin:0 0 10px 0;">Macro Cheat Sheet</h3>

    <div class="cheats">
      <div class="cheat-grid">
        <section>
          <h4>Rules</h4>
          <ul>
            <li>Text outside <code>{{ }}</code> is typed literally.</li>
            <li>Tokens are case-insensitive.</li>
            <li>Use <code>+</code> to chord modifiers, e.g. <code>{{CTRL+S}}</code>.</li>
            <li>Delays are in milliseconds. Use <code>DELAY(ms)</code>.</li>
          </ul>
        </section>

        <section>
          <h4>Commands</h4>
          <ul>
            <li><strong>DELAY(ms)</strong> — pause for <em>ms</em>. Example: <code>{{DELAY(250)}}</code></li>
            <li><strong>RANDOM(min,max)</strong> — integer in <em>[min..max]</em>.
              <br />Examples: <code>{{RANDOM(1,5)}}</code>, <code>{{DELAY(RANDOM(1000,5000))}}</code>
            </li>
            <li><strong>REPEAT(n, ...commands)</strong> — repeat the sequence <em>n</em> times.
              <br />Example: <code>{{REPEAT(5, DELAY(1000), hello, ENTER)}}</code>
            </li>
            <li><strong>TEXT(...)</strong> — type the given text exactly. Example: <code>{{TEXT(Привіт світе)}}</code></li>
            <li><strong>TAP(KEY)</strong> — press &amp; release once. Examples: <code>{{TAP(ENTER)}}</code>, <code>{{TAP(LEFT)}}</code>, <code>{{TAP(F5)}}</code></li>
            <li><strong>TAP(KEY*x)</strong> — tap key <em>x</em> times. Example: <code>{{TAP(DOWN*5)}}</code></li>
            <li><strong>DOWN(KEY)</strong> — key down (hold). <strong>UP(KEY)</strong> — key up (release).</li>
            <li><strong>HOLD(KEY)</strong> / <strong>RELEASE(KEY)</strong> — aliases for <em>DOWN/UP</em>.</li>
          </ul>
        </section>

        <section>
          <h4>Modifiers</h4>
          <p><code>CTRL</code>, <code>SHIFT</code>, <code>ALT</code>, <code>GUI</code>/<code>WIN</code>/<code>CMD</code></p>
          <p>Examples: <code>{{CTRL+S}}</code>, <code>{{ALT+TAB}}</code>, <code>{{GUI+R}}</code></p>
        </section>

        <section>
          <h4>Keys</h4>
          <p>Names: letters <code>A..Z</code>, digits <code>0..9</code>, arrows <code>LEFT/RIGHT/UP/DOWN</code>,
            <code>ENTER</code>, <code>TAB</code>, <code>ESC</code>, <code>SPACE</code>, <code>BACKSPACE</code>,
            <code>DELETE</code>, <code>HOME</code>, <code>END</code>, <code>PAGEUP</code>, <code>PAGEDOWN</code>,
            function keys <code>F1..F24</code>, keypad <code>KP0..KP9</code>, <code>KPENTER</code>, etc.</p>
        </section>

        <section>
          <h4>Examples</h4>
          <pre class="block">
  {{DELAY(300)}}hello{{ENTER}}

  {{REPEAT(3, DELAY(RANDOM(50,150)), hello, SPACE, world, ENTER)}}

  {{CTRL+SHIFT+ESC}}
  {{ALT+TAB}}{{DELAY(200)}}{{ALT+TAB}}

  {{TAP(DOWN*5)}}{{DELAY(150)}}{{TAP(ENTER)}}
          </pre>
        </section>
      </div>

      <p class="muted">Tip: add small delays between UI steps if the target app is “too fast”.</p>
    </div>

    <menu>
      <button type="button" data-close>Close</button>
    </menu>
  </dialog>

  <div id="toast"></div>
  <script src="app.js"></script>
</body>
</html>